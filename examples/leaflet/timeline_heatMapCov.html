<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <script type="text/javascript" include="leaflet.heat" src="../../dist/leaflet/include-leaflet.js"></script>
    <script src="../../dist/leaflet/include-leaflet.js"></script>
    <script type="text/javascript" include="jquery,papaparse,widgets" src="../js/include-web.js"></script>
    <script src="../../examples/js/common.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <title>Timeline Coranavirus (Heatmap)</title>
    <style type="text/css">
        .map {
            width: 100%;
            height: calc(100vh - 20px);
        }
        
        body {
            overflow: hidden;
        }
        
        #range-slider {
            position: absolute;
            left: 0.5rem;
            right: 0.5rem;
            bottom: 2.75rem;
            padding: 0.25rem 0.5rem;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            font-size: 0.8rem;
            color: #fff;
            line-height: 1;
            border-radius: 0.2rem;
            background-color: rgba(70, 70, 70, 0.8);
            z-index: 3;
        }
        
        #spread {
            display: flex;
            align-items: center;
            padding: 0.2rem;
            color: #fff;
            font-size: 0.7rem;
            text-transform: uppercase;
            background-color: #66cc66;
            border-radius: 0.2rem;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        input[type=range] {
            flex: 1;
            margin: 0 0.5rem;
            height: 1px;
            -webkit-appearance: none;
            cursor: ew-resize;
        }
        
        #range-slider label {
            display: flex;
            align-items: baseline;
            font-size: 0.7rem;
            color: #dedede;
            line-height: 1rem;
            text-transform: uppercase;
            min-width: 4.5rem;
        }
        
        .spread-label {
            background: #66cc66;
            border: none;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <div style="width: 100%;">
        <div id="divMapId" class="map">
        </div>
        <div id="range-slider" style="display: flex;">
            <input type="button" class="spread-label" value="PAUSE" id="button-play">
            <input id="slider" type="range" value="1" min="0" max="132" step="1" onchange="changeTime()">
            <label><span id="date">2020-01-11</span></label>
        </div>
    </div>
    <script type="text/javascript">
        var map = new L.map('divMapId', {
            center: {
                lon: 11.164340403295512,
                lat: 2.079745662755286
            },
            zoom: 2.116295796373197,
            zoomControl: true,
            attributionControl: false,

        });
        var heatMapLayer;
        var value = 0;
        var count = -1;
        var data = [];
        var dataNew = []
        var features = [];
        var osm = new L.ekmap.TiledOSMapLayer().addTo(map);
        for (var i = 0; i < 144; i++) {
            widgets.loader.showLoader("data loading...");
            var string = "../data/coranavirus/2020_" + i + ".json"
            $.get(string, function(response) {
                var listdata = response.features;
                features = [];
                for (var i = 0; i < listdata.length; i++) {
                    features.push({
                        "type": "Feature",
                        "properties": {
                            "date": response.date
                        },
                        "geometry": {
                            "type": "Point",
                            "coordinates": [
                                listdata[i].properties.geoid[1],
                                listdata[i].properties.geoid[0]
                            ]
                        },
                    })
                }
            }).done(function() {
                data.push(features)
                count++
                if (count == 133) {
                    for (var d = new Date(2020, 0, 11); d <= new Date(2020, 5, 2); d.setDate(d.getDate() + 1)) {
                        var day = moment(d).format('YYYY-MM-DD');
                        data.forEach(arr => {
                            if (arr[0].properties.date == day)
                                dataNew.push(arr)
                        });
                    }
                    widgets.loader.removeLoader();
                    var geojson = {
                        "type": "FeatureCollection",
                        "features": data[0]
                    }
                    heatMapLayer = L.heatLayer(geojson, {
                        radius: 10,
                        minOpacity: 0.5
                    }).addTo(map);
                    console.log(heatMapLayer);


                }
            })
        }

        function getValue() {
            value++;
            return value
        }
    </script>
</body>

</html>